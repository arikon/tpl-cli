var FS = require('fs');

module.exports = {

    onCreate: function(d, v, namedArgs, projectName) {

        var date = new Date(),
            day = data.getDate(),
            month = data.getMonth() + 1,
            year = date.getFullYear(),
            dateStr = day + '.' + month + '.' + year,
            projectUpper = projectName.toUpperCase();

        // Add leading zero to month
        if (String(month).length < 2) month = '0' + month;

        // Update the files that reference this project by name
        [
            'package.json',
            'index.js',
            'GNUmakefile',
            'ChangeLog.md',
            'README.md.in',
            'LICENSE',
            'bin/app.in'
        ].forEach(function (name) {
            v.write(name, v.template(v.read(name), {
                app: projectName,
                APP: projectUpper,
                APP_ENV: projectUpper.replace(/-/g, '_'),
                year: year,
                date: dateStr
            }));
        });

        // Rename bin/app.in to bin/{app} and make it executable
        var from = 'bin/app.in',
            to = 'bin/' + projectName;
        v.mv(from, to);
        FS.chmodSync(to, '0755');

        // Rename README.md.in to README.md
        v.mv('README.md.in', 'README.md');

        // Remove this volofile
        v.rm('volofile');

        console.log([
            'Project directory is ready!',
            '',
            'Do not forget to',
            '- run `npm init` to initialize npm package',
            '- run `git init` to create git repository',
            '- review CONTRIBUTING.md',
            '- commit your project'
            ].join('\n'));

        d.resolve();

    }

};
